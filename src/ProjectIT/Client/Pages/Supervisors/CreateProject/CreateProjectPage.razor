@page "/create-project"
@using ProjectIT.Client.Components.Filter
@using ProjectIT.Client.Components.ProjectCard
@using ProjectIT.Client.Components.Search
@using ProjectIT.Client.Components.Tag
@using ProjectIT.Client.Components.Panel
@using ProjectIT.Client.Http;
@using ProjectIT.Shared.Enums;
@using ProjectIT.Shared.Models;
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject AnonymousClient httpClient
@inject NavigationManager navManager
@inject IJSRuntime JSRuntime

<div class="d-flex flex-row justify-content-center gap-5">
    <div class="d-flex flex-column my-4 py-3 gap-4 filter-size">
        <Panel Title="Programmes">
            <RadzenCheckBoxList TValue="Programme" Data="@programmeWrappers" @bind-Value=@projectProgrammes
                TextProperty="StringValue" ValueProperty="Programme" Orientation="Orientation.Vertical" />
        </Panel>
        <Panel Title="ECTS Points">
            <RadzenRadioButtonList TValue="Ects?" Data="ectsWrappers" @bind-Value=projectEcts TextProperty="StringValue"
                ValueProperty="Ects" Orientation="Orientation.Vertical" />
        </Panel>
    </div>
    <div class="d-flex flex-column mb-4 main-view-size">
        <EditForm Model="@project" OnSubmit="SubmitProjectAsync">
            <p class="fs-7 fw-bold">Title</p>
            <InputText class="border border-0 shadow rounded-1 fs-7 px-3 mb-4" style="width: 45rem; height: 2.5rem"
                @bind-Value="project!.Title" placeholder="Title here..." />
            <p class="fs-7 fw-bold">Description</p>
            <RadzenHtmlEditor @bind-Value="@descriptionHtml" class="border border-0 shadow mb-4"
                style="height:40rem; width: 45rem" />
            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-danger fw-bold py-1 btn-style" @onclick="CancelProjectAsync">
                    Cancel
                </button>
                <button type="submit" class="btn btn-success fw-bold py-1 ms-3 btn-style">
                    Post
                </button>
            </div>
        </EditForm>
    </div>
    <div class="d-flex flex-column my-4 py-3 gap-4">
        @{
            DateTime date = DateTime.Now;
        }
        <Panel Title="Semester">
            <RadzenRadioButtonList @bind-Value=project.Semester TValue="Semester">
                <Items>
                    <RadzenRadioButtonListItem Text=@($"Spring {date.Year}")
                        Value="new Semester { Season = Season.Spring, Year = date.Year }" />
                    <RadzenRadioButtonListItem Text=@($"Autumn {date.Year}")
                        Value="new Semester { Season = Season.Autumn, Year = date.Year }" />
                    <RadzenRadioButtonListItem Text=@($"Spring {date.Year + 1}")
                        Value="new Semester { Season = Season.Spring, Year = date.Year + 1 }" />
                    <RadzenRadioButtonListItem Text=@($"Autumn {date.Year + 1}")
                        Value="new Semester { Season = Season.Autumn, Year = date.Year + 1 }" />
                </Items>
            </RadzenRadioButtonList>
        </Panel>
        <Panel Title="Language">
            <RadzenCheckBoxList TValue="Language" Data="@languageWrappers" @bind-Value=@projectLanguages
                TextProperty="StringValue" ValueProperty="Language" Orientation="Orientation.Vertical" />
        </Panel>
            <Panel Title="Topics">
                <div class="d-flex flex-column gap-2">
                    @if (topics is not null)
                    {
                        <RadzenDropDown @ref="topicSelector" 
                                        TValue="Topic" 
                                        Placeholder="Select topics" 
                                        AllowFiltering="true"
                                        ClearSearchAfterSelection="true" 
                                        FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                        Data=@topics 
                                        Change="OnTopicSelectedInList" 
                                        ValueProperty="Name" 
                                        TextProperty="Name"
                                        class="flex-grow-1">
                            <Template>
                                @context.Name
                            </Template>
                        </RadzenDropDown>
                    }
                    <div class="d-flex flex-row gap-2">
                        <form class="d-flex gap-2">
                            <SearchField PlaceholderText="Create new topics..." ShowSearchIcon="false" Width="14.5rem" OnInputValueChanged="(newVal) => topicName = newVal" />
                            <button type="reset" value="reset" class="bg-transparent border-0 add-image-size" @onclick=OnAddNewTopicFromSearchClicked>
                                <img class="rotate-45 w-100 h-70" src="images/baseline_clear_24.png" alt="Add new topic">
                            </button>
                        </form>
                        @* <input class="rounded-pill ps-3" @bind="topicName" placeholder="Create new topics...">
                        <button class="bg-transparent border-0 add-image-size" @onclick=OnAddNewTopicFromSearchClicked>
                            <img class="rotate-45 w-100 h-70" src="images/baseline_clear_24.png" alt="Add new topic">
                        </button> *@
                    </div>
                </div>
                @foreach (var topic in projectTopics)
                {
                    <TagBox Tag="@(new FilterTag { Tag = topic.Name })" IsDisabled="false"
                OnClicked="() => OnSelectedTopicClicked(topic)" />
                }
            </Panel>
    </div>
</div>