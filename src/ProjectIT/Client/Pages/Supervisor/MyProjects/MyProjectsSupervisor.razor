@page "/my-projects"
@using ProjectIT.Client.Components.Dropdown
@using ProjectIT.Client.Components.ProjectCard
@inject NavigationManager navigationManager

<PageTitle>My Projects</PageTitle>

<div class="d-flex justify-content-center">
    <div class="d-flex flex-column">
        <h3 class="fw-bold d-block my-3">My projects</h3>
        <div class="d-flex justify-content-between my-4">
            <button class="rounded rounded-3 bg-black text-white px-4" @onclick="@(() => navigationManager.NavigateTo("/create-project"))">Create new project</button>
            <RadzenDropDown TValue="string"
                            @bind-Value=@sortValue
                            Data=@(_sortValues.Select(sortVal => sortVal.ToString()))
                            Change="@OnSort"
                            Placeholder="Sort by"
                            Style="width: 20%; max-width: 20rem;" />
        </div>
        @if (projects != null)
        {
            var appliedProjects = projects.Where(p => p.Students.Count() > 0);

            if (appliedProjects.Any())
            {
                <span class="my-3 fs-6">Applied projects</span>
                @foreach (var project in appliedProjects)
                {
                    <ProjectCard IsOnMyProjects="true"
                                 Id="@project.Id"
                                 Title="@project.Title"
                                 DescriptionHtml="@project.DescriptionHtml"
                                 Programmes="@project.Programmes"
                                 Ects="@project.Ects"
                                 Semester="@project.Semester" />

                    <Dropdown BootstrapIcon="gear-fill">
                        <DropdownItems>
                            <DropdownItem Text="Edit" OnClick="@(() => navigationManager.NavigateTo($"/my-projects/{project.Id}/edit"))" />
                            <hr class="dropdown-divider" />
                            <DropdownItem Text="Delete" OnClick="() => DeleteProject(project.Id)" />
                        </DropdownItems>
                    </Dropdown>
                }
                <hr class="w-50 align-self-center">
            }
            foreach (var project in projects.Where(p => p.Students == null || p.Students.Count() == 0))
            {
                <ProjectCard IsOnMyProjects="true"
                             Id="@project.Id"
                             Title="@project.Title"
                             DescriptionHtml="@project.DescriptionHtml"
                             Programmes="@project.Programmes"
                             Ects="@project.Ects"
                             Semester="@project.Semester"
                             CssClasses="mt-3" />
            }
        }
    </div>
</div>