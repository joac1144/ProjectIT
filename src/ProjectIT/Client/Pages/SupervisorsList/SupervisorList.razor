@page "/supervisor-list"
@using ProjectIT.Client.Http;
@using ProjectIT.Client.Components.Filter
@using ProjectIT.Client.Components.Search
@using ProjectIT.Client.Components.Tag
@using ProjectIT.Shared.Dtos.Users;
@using ProjectIT.Client.Components.SupervisorCard
@inject AnonymousClient anonymousClient

<div class="mt-3">
    <div class="d-flex row justify-content-center">
        <div class="col-md-3 filter-size">
            <div class="d-flex flex-column justify-content-center px-4">
                <p class="h1 fw-bold">@filteredSupervisors?.Count()</p>
                <p class="h6">Supervisors found</p>
            </div>
            <div class="my-4">
                <FilterPanelTopics OnInitializedData="FilterPanelTopicsInitialized" DataChanged="OnFilterPanelTopicsTagChanged" />
            </div>
        </div>
        <div class="col-md-5 main-view-size">
            <div class="mb-4">
                <SearchField @ref="searchField" PlaceholderText="Search supervisors..." Height="2.4rem" Width="35rem" OnInputValueChanged="FilterSupervisors" />
            </div>
            <div class="tags-display-size mb-4">
                <TagsDisplay @bind-Tags="tags" TagsAreClickable="true" OnTagClicked="OnTagClickedInTagsDisplay" />
                @if (tags.Any(t => t.Selected))
                {
                    <span class="clearbtn ms-3">
                        <button class="btn p-0" @onclick="ClearFilters">Clear filters</button>
                    </span>
                }
            </div>
            @if (filteredSupervisors != null)
            {
                <Virtualize TItem="SupervisorDetailsDto" Items="@shownSupervisors" Context="supervisor">
                        <SupervisorCard FullName = "@supervisor.FullName"
                                        Topics = "@supervisor.Topics" />
                </Virtualize>
            }
            @if (filteredSupervisors!.Count > pageSize)
            {
                <div class="pageButtonsDiv my-3 py-2">
                    <button class="btn mx-1 rounded rounded-5 btn bg-black text-white" @onclick="@(e => NewPage("prev"))"> Previous </button>

                    @for (int i = 0; i < totalPages; i++)
                    {
                        var pageNumber = i;
                        <button class="btn mx-1 rounded rounded-5 @(currentPage == pageNumber ? "bg-white text-black shadow" : "bg-black text-white")"
                        @onclick="@(e => UpdateSupervisors(pageNumber))"> @(i+1)</button>
                    }

                    <button class="btn mx-1 rounded rounded-5 bg-black text-white" @onclick="@(e => NewPage("next"))"> Next </button>
                </div>
            }
        </div>
    </div>
</div>